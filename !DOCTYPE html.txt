<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Aatrox Build Scorer</title>
<style>
  body { font-family: sans-serif; padding: 20px; }
  textarea { width: 100%; height: 200px; }
  input[type=number] { width: 60px; }
  table, th, td { border: 1px solid #999; border-collapse: collapse; padding: 4px; }
  th { background: #eee; }
</style>
</head>
<body>

<h2>Aatrox Item & Ability Scorer</h2>

<h3>CSV Input</h3>
<textarea id="csvInput"></textarea>

<h3>Base Stats</h3>
<label>BASE AD: <input id="baseAD" type="number" value="258"></label>
<label>BASE HP: <input id="baseHP" type="number" value="2769"></label>
<label>Armor: <input id="armor" type="number" value="120"></label>
<label>MR: <input id="mr" type="number" value="67"></label>
<label>AS: <input id="as" type="number" value="0.93"></label>
<label>BASIC ABILITY AH: <input id="abAh" type="number" value="15"></label>

<h3>Weights</h3>
<label>Damage: <input type="number" id="weightDamage" value="0.5" step="0.05"></label>
<label>Healing: <input type="number" id="weightHealing" value="0.25" step="0.05"></label>
<label>Tankiness: <input type="number" id="weightTank" value="0.125" step="0.05"></label>
<label>Utility: <input type="number" id="weightUtility" value="0.125" step="0.05"></label>

<h3>Enemy Stats</h3>
<label>Enemy Armor: <input id="enemyArmor" type="number" value="100"></label>
<label>Enemy MR: <input id="enemyMR" type="number" value="50"></label>

<button onclick="scoreItems()">Calculate Scores</button>

<h3>Ranked Items</h3>
<div id="results"></div>

<script>
// ----------------- HELPER FUNCTIONS -----------------
function parseValue(val) {
  if (!val) return 0;
  let match = val.match(/[\d.]+/);
  if (!match) return 0;
  let num = parseFloat(match[0]);
  if (val.includes('%')) return num / 100;
  return num;
}

function parseCSV(csv) {
  const lines = csv.trim().split('\n');
  const headers = lines.shift().split(',').map(h=>h.trim());
  return lines.map(line => {
    const cells = line.split(',').map(c=>c.trim());
    let obj = {};
    headers.forEach((h,i)=>obj[h]=cells[i]||'');
    return obj;
  });
}

// Calculate damage after resistances
function applyResist(damage, type, enemyArmor, enemyMR) {
  if (type.toLowerCase() === 'physical') return damage * 100 / (100 + enemyArmor);
  if (type.toLowerCase() === 'magic') return damage * 100 / (100 + enemyMR);
  return damage; // True damage unaffected
}

// ----------------- SCORING -----------------
function scoreItems() {
  const csvText = document.getElementById('csvInput').value;
  const items = parseCSV(csvText);
  
  const baseAD = parseFloat(document.getElementById('baseAD').value);
  const baseHP = parseFloat(document.getElementById('baseHP').value);
  const baseArmor = parseFloat(document.getElementById('armor').value);
  const baseMR = parseFloat(document.getElementById('mr').value);
  const baseAS = parseFloat(document.getElementById('as').value);
  const basicAH = parseFloat(document.getElementById('abAh').value);
  
  const weightDamage = parseFloat(document.getElementById('weightDamage').value);
  const weightHealing = parseFloat(document.getElementById('weightHealing').value);
  const weightTank = parseFloat(document.getElementById('weightTank').value);
  const weightUtility = parseFloat(document.getElementById('weightUtility').value);
  
  const enemyArmor = parseFloat(document.getElementById('enemyArmor').value);
  const enemyMR = parseFloat(document.getElementById('enemyMR').value);
  
  // Columns mapped to categories
  const categoryCols = {
    damage: ['AD','Lethality','%Pen','AS','AH','Empowered AA'],
    healing: ['Lifesteal','Sustain','Omnivamp'],
    tankiness: ['Health','Armor','MR','Tenacity'],
    utility: ['Move Speed','Slow','Ult-CDR','BasicAbility-CDR']
  };
  
  function scoreItem(item) {
    let total = 0;
    // Score item stats by weights
    for (const [cat, cols] of Object.entries(categoryCols)) {
      let catScore = 0;
      cols.forEach(col => {
        if (item[col]) catScore += parseValue(item[col]);
      });
      if (cat==='damage') total += catScore * weightDamage;
      if (cat==='healing') total += catScore * weightHealing;
      if (cat==='tankiness') total += catScore * weightTank;
      if (cat==='utility') total += catScore * weightUtility;
    }
    // Optionally, add ability scaling here in future
    return total;
  }
  
  const scoredItems = items.map(item => ({
    name: item[''],
    score: scoreItem(item),
    data: item
  }));
  
  scoredItems.sort((a,b)=>b.score-a.score);
  
  // Display results
  const resultsDiv = document.getElementById('results');
  let html = '<table><tr><th>Item</th><th>Score</th></tr>';
  scoredItems.forEach(i => {
    html += `<tr><td>${i.name}</td><td>${i.score.toFixed(2)}</td></tr>`;
  });
  html += '</table>';
  resultsDiv.innerHTML = html;
}
</script>

</body>
</html>
